{"version":3,"sources":["../src/index.js"],"names":["document","addEventListener","event","simpleMarkdown","getElementById","md","window","markdownit","use","markdownitFootnote","markdownitTaskLists","editor","preview","workingNote","permissions","name","componentManager","ComponentManager","loggingEnabled","streamContextItem","note","value","content","text","innerHTML","render","updatePreviewText","saveItem","pressed","startWidth","offsetWidth","startX","lastDownX","columnResizer","resizerWidth","safetyOffset","clientX","classList","add","x","colLeft","style","left","width","removeSelection","remove","getSelection","removeAllRanges","selection","empty","shiftKey","which","preventDefault","console","log","execCommand","start","selectionStart","end","selectionEnd","spaces","substring"],"mappings":"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","file":"dist.js","sourcesContent":["document.addEventListener(\"DOMContentLoaded\", function(event) {\n\n  var simpleMarkdown = document.getElementById(\"simple-markdown\");\n  if(!simpleMarkdown) {\n    return;\n  }\n\n  const md = window.markdownit().use(window.markdownitFootnote).use(window.markdownitTaskLists);\n\n  var editor = document.getElementById(\"editor\");\n  var preview = document.getElementById(\"preview\");\n\n  var workingNote;\n\n  var permissions = [\n    {\n      name: \"stream-context-item\"\n    }\n  ]\n\n  var componentManager = new ComponentManager(permissions, function(){\n    // on ready\n  });\n\n  componentManager.loggingEnabled = true;\n\n  componentManager.streamContextItem((note) => {\n    workingNote = note;\n    editor.value = note.content.text;\n    preview.innerHTML = md.render(note.content.text);\n  });\n\n  updatePreviewText();\n\n  document.getElementById(\"editor\").addEventListener(\"input\", function(event){\n    var text = updatePreviewText();\n    if(workingNote) {\n      workingNote.content.text = text;\n      componentManager.saveItem(workingNote);\n    }\n  })\n\n  function updatePreviewText() {\n    var text = editor.value || \"\";\n    preview.innerHTML = md.render(text);\n    return text;\n  }\n\n  var pressed = false;\n  var startWidth = editor.offsetWidth;\n  var startX;\n  var lastDownX;\n\n  var columnResizer = document.getElementById(\"column-resizer\");\n  var resizerWidth = columnResizer.offsetWidth;\n\n  var safetyOffset = 15;\n\n  columnResizer.addEventListener(\"mousedown\", function(event){\n    pressed = true;\n    lastDownX = event.clientX;\n    columnResizer.classList.add(\"dragging\");\n    editor.classList.add(\"no-selection\");\n  })\n\n  document.addEventListener(\"mousemove\", function(event){\n    if(!pressed) {\n      return;\n    }\n\n    var x = event.clientX;\n    if(x < resizerWidth/2 + safetyOffset) {\n      x = resizerWidth/2 + safetyOffset;\n    } else if(x > simpleMarkdown.offsetWidth - resizerWidth - safetyOffset) {\n      x = simpleMarkdown.offsetWidth - resizerWidth - safetyOffset;\n    }\n\n    var colLeft = x - resizerWidth/2;\n    columnResizer.style.left = colLeft + \"px\";\n\n    editor.style.width = (colLeft - safetyOffset) + \"px\";\n\n    removeSelection();\n\n  })\n\n  document.addEventListener(\"mouseup\", function(event){\n    if(pressed) {\n      pressed = false;\n      columnResizer.classList.remove(\"dragging\");\n      editor.classList.remove(\"no-selection\");\n    }\n  })\n\n  function removeSelection() {\n    if (window.getSelection) {\n      window.getSelection().removeAllRanges();\n    } else if (document.selection) {\n      document.selection.empty();\n    }\n  }\n\n  // Tab handler\n  editor.addEventListener('keydown', function(event){\n    if (!event.shiftKey && event.which == 9) {\n      event.preventDefault();\n\n      console.log(document);\n\n      // Using document.execCommand gives us undo support\n      if(!document.execCommand(\"insertText\", false, \"\\t\")) {\n        // document.execCommand works great on Chrome/Safari but not Firefox\n        var start = this.selectionStart;\n        var end = this.selectionEnd;\n        var spaces = \"    \";\n\n         // Insert 4 spaces\n        this.value = this.value.substring(0, start)\n          + spaces + this.value.substring(end);\n\n        // Place cursor 4 spaces away from where\n        // the tab key was pressed\n        this.selectionStart = this.selectionEnd = start + 4;\n      }\n    }\n  });\n\n});\n"]}