{"version":3,"sources":["app.js"],"names":["document","addEventListener","event","simpleMarkdown","getElementById","md","window","markdownit","use","markdownitFootnote","markdownitTaskLists","editor","preview","workingNote","permissions","name","componentManager","ComponentManager","streamContextItem","note","value","content","text","innerHTML","render","updatePreviewText","saveItem","pressed","startWidth","offsetWidth","startX","lastDownX","columnResizer","resizerWidth","safetyOffset","clientX","classList","add","x","colLeft","style","left","width","removeSelection","remove","getSelection","removeAllRanges","selection","empty","shiftKey","which","preventDefault","console","log","execCommand","start","selectionStart","end","selectionEnd","spaces","substring"],"mappings":";;AAAAA,SAASC,gBAAT,CAA0B,kBAA1B,EAA8C,UAASC,KAAT,EAAgB;;AAE5D,MAAIC,iBAAiBH,SAASI,cAAT,CAAwB,iBAAxB,CAArB;AACA,MAAG,CAACD,cAAJ,EAAoB;AAClB;AACD;;AAED,MAAME,KAAKC,OAAOC,UAAP,GAAoBC,GAApB,CAAwBF,OAAOG,kBAA/B,EAAmDD,GAAnD,CAAuDF,OAAOI,mBAA9D,CAAX;;AAEA,MAAIC,SAASX,SAASI,cAAT,CAAwB,QAAxB,CAAb;AACA,MAAIQ,UAAUZ,SAASI,cAAT,CAAwB,SAAxB,CAAd;;AAEA,MAAIS,WAAJ;;AAEA,MAAIC,cAAc,CAChB;AACEC,UAAM;AADR,GADgB,CAAlB;;AAMA,MAAIC,mBAAmB,IAAIC,gBAAJ,CAAqBH,WAArB,EAAkC,YAAU;AACjE;AACD,GAFsB,CAAvB;;AAIA;;AAEAE,mBAAiBE,iBAAjB,CAAmC,UAACC,IAAD,EAAU;AAC3CN,kBAAcM,IAAd;AACAR,WAAOS,KAAP,GAAeD,KAAKE,OAAL,CAAaC,IAA5B;AACAV,YAAQW,SAAR,GAAoBlB,GAAGmB,MAAH,CAAUL,KAAKE,OAAL,CAAaC,IAAvB,CAApB;AACD,GAJD;;AAMAG;;AAEAzB,WAASI,cAAT,CAAwB,QAAxB,EAAkCH,gBAAlC,CAAmD,OAAnD,EAA4D,UAASC,KAAT,EAAe;AACzE,QAAIoB,OAAOG,mBAAX;AACA,QAAGZ,WAAH,EAAgB;AACdA,kBAAYQ,OAAZ,CAAoBC,IAApB,GAA2BA,IAA3B;AACAN,uBAAiBU,QAAjB,CAA0Bb,WAA1B;AACD;AACF,GAND;;AAQA,WAASY,iBAAT,GAA6B;AAC3B,QAAIH,OAAOX,OAAOS,KAAP,IAAgB,EAA3B;AACAR,YAAQW,SAAR,GAAoBlB,GAAGmB,MAAH,CAAUF,IAAV,CAApB;AACA,WAAOA,IAAP;AACD;;AAED,MAAIK,UAAU,KAAd;AACA,MAAIC,aAAajB,OAAOkB,WAAxB;AACA,MAAIC,MAAJ;AACA,MAAIC,SAAJ;;AAEA,MAAIC,gBAAgBhC,SAASI,cAAT,CAAwB,gBAAxB,CAApB;AACA,MAAI6B,eAAeD,cAAcH,WAAjC;;AAEA,MAAIK,eAAe,EAAnB;;AAEAF,gBAAc/B,gBAAd,CAA+B,WAA/B,EAA4C,UAASC,KAAT,EAAe;AACzDyB,cAAU,IAAV;AACAI,gBAAY7B,MAAMiC,OAAlB;AACAH,kBAAcI,SAAd,CAAwBC,GAAxB,CAA4B,UAA5B;AACA1B,WAAOyB,SAAP,CAAiBC,GAAjB,CAAqB,cAArB;AACD,GALD;;AAOArC,WAASC,gBAAT,CAA0B,WAA1B,EAAuC,UAASC,KAAT,EAAe;AACpD,QAAG,CAACyB,OAAJ,EAAa;AACX;AACD;;AAED,QAAIW,IAAIpC,MAAMiC,OAAd;AACA,QAAGG,IAAIL,eAAa,CAAb,GAAiBC,YAAxB,EAAsC;AACpCI,UAAIL,eAAa,CAAb,GAAiBC,YAArB;AACD,KAFD,MAEO,IAAGI,IAAInC,eAAe0B,WAAf,GAA6BI,YAA7B,GAA4CC,YAAnD,EAAiE;AACtEI,UAAInC,eAAe0B,WAAf,GAA6BI,YAA7B,GAA4CC,YAAhD;AACD;;AAED,QAAIK,UAAUD,IAAIL,eAAa,CAA/B;AACAD,kBAAcQ,KAAd,CAAoBC,IAApB,GAA2BF,UAAU,IAArC;;AAEA5B,WAAO6B,KAAP,CAAaE,KAAb,GAAsBH,UAAUL,YAAX,GAA2B,IAAhD;;AAEAS;AAED,GAnBD;;AAqBA3C,WAASC,gBAAT,CAA0B,SAA1B,EAAqC,UAASC,KAAT,EAAe;AAClD,QAAGyB,OAAH,EAAY;AACVA,gBAAU,KAAV;AACAK,oBAAcI,SAAd,CAAwBQ,MAAxB,CAA+B,UAA/B;AACAjC,aAAOyB,SAAP,CAAiBQ,MAAjB,CAAwB,cAAxB;AACD;AACF,GAND;;AAQA,WAASD,eAAT,GAA2B;AACzB,QAAIrC,OAAOuC,YAAX,EAAyB;AACvBvC,aAAOuC,YAAP,GAAsBC,eAAtB;AACD,KAFD,MAEO,IAAI9C,SAAS+C,SAAb,EAAwB;AAC7B/C,eAAS+C,SAAT,CAAmBC,KAAnB;AACD;AACF;;AAED;AACArC,SAAOV,gBAAP,CAAwB,SAAxB,EAAmC,UAASC,KAAT,EAAe;AAChD,QAAI,CAACA,MAAM+C,QAAP,IAAmB/C,MAAMgD,KAAN,IAAe,CAAtC,EAAyC;AACvChD,YAAMiD,cAAN;;AAEAC,cAAQC,GAAR,CAAYrD,QAAZ;;AAEA;AACA,UAAG,CAACA,SAASsD,WAAT,CAAqB,YAArB,EAAmC,KAAnC,EAA0C,IAA1C,CAAJ,EAAqD;AACnD;AACA,YAAIC,QAAQ,KAAKC,cAAjB;AACA,YAAIC,MAAM,KAAKC,YAAf;AACA,YAAIC,SAAS,MAAb;;AAEC;AACD,aAAKvC,KAAL,GAAa,KAAKA,KAAL,CAAWwC,SAAX,CAAqB,CAArB,EAAwBL,KAAxB,IACTI,MADS,GACA,KAAKvC,KAAL,CAAWwC,SAAX,CAAqBH,GAArB,CADb;;AAGA;AACA;AACA,aAAKD,cAAL,GAAsB,KAAKE,YAAL,GAAoBH,QAAQ,CAAlD;AACD;AACF;AACF,GAtBD;AAwBD,CA/HD","file":"app.js","sourcesContent":["document.addEventListener(\"DOMContentLoaded\", function(event) {\n\n  var simpleMarkdown = document.getElementById(\"simple-markdown\");\n  if(!simpleMarkdown) {\n    return;\n  }\n\n  const md = window.markdownit().use(window.markdownitFootnote).use(window.markdownitTaskLists);\n\n  var editor = document.getElementById(\"editor\");\n  var preview = document.getElementById(\"preview\");\n\n  var workingNote;\n\n  var permissions = [\n    {\n      name: \"stream-context-item\"\n    }\n  ]\n\n  var componentManager = new ComponentManager(permissions, function(){\n    // on ready\n  });\n\n  // componentManager.loggingEnabled = true;\n\n  componentManager.streamContextItem((note) => {\n    workingNote = note;\n    editor.value = note.content.text;\n    preview.innerHTML = md.render(note.content.text);\n  });\n\n  updatePreviewText();\n\n  document.getElementById(\"editor\").addEventListener(\"input\", function(event){\n    var text = updatePreviewText();\n    if(workingNote) {\n      workingNote.content.text = text;\n      componentManager.saveItem(workingNote);\n    }\n  })\n\n  function updatePreviewText() {\n    var text = editor.value || \"\";\n    preview.innerHTML = md.render(text);\n    return text;\n  }\n\n  var pressed = false;\n  var startWidth = editor.offsetWidth;\n  var startX;\n  var lastDownX;\n\n  var columnResizer = document.getElementById(\"column-resizer\");\n  var resizerWidth = columnResizer.offsetWidth;\n\n  var safetyOffset = 15;\n\n  columnResizer.addEventListener(\"mousedown\", function(event){\n    pressed = true;\n    lastDownX = event.clientX;\n    columnResizer.classList.add(\"dragging\");\n    editor.classList.add(\"no-selection\");\n  })\n\n  document.addEventListener(\"mousemove\", function(event){\n    if(!pressed) {\n      return;\n    }\n\n    var x = event.clientX;\n    if(x < resizerWidth/2 + safetyOffset) {\n      x = resizerWidth/2 + safetyOffset;\n    } else if(x > simpleMarkdown.offsetWidth - resizerWidth - safetyOffset) {\n      x = simpleMarkdown.offsetWidth - resizerWidth - safetyOffset;\n    }\n\n    var colLeft = x - resizerWidth/2;\n    columnResizer.style.left = colLeft + \"px\";\n\n    editor.style.width = (colLeft - safetyOffset) + \"px\";\n\n    removeSelection();\n\n  })\n\n  document.addEventListener(\"mouseup\", function(event){\n    if(pressed) {\n      pressed = false;\n      columnResizer.classList.remove(\"dragging\");\n      editor.classList.remove(\"no-selection\");\n    }\n  })\n\n  function removeSelection() {\n    if (window.getSelection) {\n      window.getSelection().removeAllRanges();\n    } else if (document.selection) {\n      document.selection.empty();\n    }\n  }\n\n  // Tab handler\n  editor.addEventListener('keydown', function(event){\n    if (!event.shiftKey && event.which == 9) {\n      event.preventDefault();\n\n      console.log(document);\n\n      // Using document.execCommand gives us undo support\n      if(!document.execCommand(\"insertText\", false, \"\\t\")) {\n        // document.execCommand works great on Chrome/Safari but not Firefox\n        var start = this.selectionStart;\n        var end = this.selectionEnd;\n        var spaces = \"    \";\n\n         // Insert 4 spaces\n        this.value = this.value.substring(0, start)\n          + spaces + this.value.substring(end);\n\n        // Place cursor 4 spaces away from where\n        // the tab key was pressed\n        this.selectionStart = this.selectionEnd = start + 4;\n      }\n    }\n  });\n\n});\n"]}